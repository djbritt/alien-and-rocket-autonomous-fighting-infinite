<html><head><base href="https://websim.ai" />
<title>AI Spaceship Battle - Edge Collision Fix</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }
  .ship {
    position: absolute;
    font-size: 24px;
    color: white;
    user-select: none;
    z-index: 2;
    transition: transform 0.2s ease-in-out;
  }
  .laser {
    position: absolute;
    background-color: #ff00ff;
    width: 10px;
    height: 3px;
    user-select: none;
    z-index: 2;
  }
  #gameOver {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: red;
    display: none;
    z-index: 3;
    text-align: center;
  }
  #winner {
    font-size: 36px;
    color: gold;
    margin-top: 20px;
  }
  .star {
    position: absolute;
    background-color: white;
    border-radius: 50%;
    z-index: 1;
  }
  #speedControl {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(255,255,255,0.2);
    padding: 10px;
    border-radius: 5px;
    z-index: 4;
  }
  #speedDisplay {
    color: white;
    font-size: 18px;
    margin-bottom: 5px;
  }
  button {
    background: #4CAF50;
    border: none;
    color: white;
    padding: 5px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 2px;
    cursor: pointer;
    border-radius: 3px;
  }
</style>
</head>
<body>
<div id="ship1" class="ship">ðŸš€</div>
<div id="ship2" class="ship">ðŸ›¸</div>
<div id="gameOver">
  GAME OVER
  <div id="winner"></div>
</div>
<div id="speedControl">
  <div id="speedDisplay">Speed: 1x</div>
  <button id="speedUp">Speed Up</button>
  <button id="speedDown">Slow Down</button>
</div>

<script>
const ship1 = document.getElementById('ship1');
const ship2 = document.getElementById('ship2');
const gameOver = document.getElementById('gameOver');
const winner = document.getElementById('winner');
const speedDisplay = document.getElementById('speedDisplay');
const speedUpBtn = document.getElementById('speedUp');
const speedDownBtn = document.getElementById('speedDown');

let ship1X = 50, ship1Y = 50;
let ship2X = window.innerWidth - 50, ship2Y = window.innerHeight - 50;
let ship1Dx = 2, ship1Dy = 2;
let ship2Dx = -2, ship2Dy = -2;
let isGameOver = false;
let lasers = [];
let speedMultiplier = 1;

const SHIP_SIZE = 24;
const BASE_SPEED = 3;
const MAX_SPEED = 5;
const MIN_SPEED = 0.5;

function moveShip(ship, x, y, angle) {
  ship.style.left = x + 'px';
  ship.style.top = y + 'px';
  ship.style.transform = `rotate(${angle}rad)`;
}

function createLaser(x, y, dx, dy, shipId) {
  const laser = document.createElement('div');
  laser.className = 'laser';
  laser.style.left = x + 'px';
  laser.style.top = y + 'px';
  
  const angle = Math.atan2(dy, dx);
  laser.style.transform = `rotate(${angle}rad)`;
  
  document.body.appendChild(laser);

  const newLaser = { element: laser, x, y, dx, dy, shipId };
  lasers.push(newLaser);
  return newLaser;
}

function moveLasers() {
  lasers = lasers.filter(laser => {
    laser.x += laser.dx * 5 * speedMultiplier;
    laser.y += laser.dy * 5 * speedMultiplier;
    laser.element.style.left = laser.x + 'px';
    laser.element.style.top = laser.y + 'px';

    if (laser.x < 0 || laser.x > window.innerWidth || laser.y < 0 || laser.y > window.innerHeight) {
      laser.element.remove();
      return false;
    }

    if (laser.shipId !== 1 && checkCollision(laser.x, laser.y, ship1X, ship1Y)) {
      laser.element.remove();
      gameOverSequence(2);
      return false;
    } else if (laser.shipId !== 2 && checkCollision(laser.x, laser.y, ship2X, ship2Y)) {
      laser.element.remove();
      gameOverSequence(1);
      return false;
    }

    return true;
  });
}

function checkCollision(x1, y1, x2, y2) {
  const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
  return distance < SHIP_SIZE;
}

function gameOverSequence(winningShip) {
  if (!isGameOver) {
    isGameOver = true;
    gameOver.style.display = 'block';
    winner.textContent = winningShip === 1 ? "ðŸš€ Rocket Wins!" : "ðŸ›¸ Alien Wins!";
    setTimeout(() => {
      gameOver.style.display = 'none';
      winner.textContent = '';
      resetGame();
    }, 3000);
  }
}

function resetGame() {
  ship1X = Math.random() * (window.innerWidth - SHIP_SIZE);
  ship1Y = Math.random() * (window.innerHeight - SHIP_SIZE);
  ship2X = Math.random() * (window.innerWidth - SHIP_SIZE);
  ship2Y = Math.random() * (window.innerHeight - SHIP_SIZE);
  ship1Dx = (Math.random() - 0.5) * 4;
  ship1Dy = (Math.random() - 0.5) * 4;
  ship2Dx = (Math.random() - 0.5) * 4;
  ship2Dy = (Math.random() - 0.5) * 4;
  isGameOver = false;
  lasers.forEach(laser => laser.element.remove());
  lasers = [];
}

function createStar() {
  const star = document.createElement('div');
  star.className = 'star';
  star.style.left = Math.random() * window.innerWidth + 'px';
  star.style.top = Math.random() * window.innerHeight + 'px';
  const size = Math.random() * 2 + 1;
  star.style.width = size + 'px';
  star.style.height = size + 'px';
  star.style.opacity = Math.random() * 0.5 + 0.5;
  document.body.appendChild(star);

  setTimeout(() => {
    star.remove();
  }, Math.random() * 5000 + 5000);
}

function addStars() {
  if (Math.random() < 0.1) {
    createStar();
  }
}

function updateShipDirection(shipX, shipY, shipDx, shipDy, enemyX, enemyY) {
  const nearbyLasers = lasers.filter(laser => 
    laser.shipId !== (shipX === ship1X ? 1 : 2) && 
    Math.abs(laser.x - shipX) < 100 && 
    Math.abs(laser.y - shipY) < 100
  );

  if (nearbyLasers.length > 0) {
    // Evasive maneuver
    const closestLaser = nearbyLasers.reduce((closest, laser) => {
      const distance = Math.sqrt((laser.x - shipX)**2 + (laser.y - shipY)**2);
      return distance < closest.distance ? {laser, distance} : closest;
    }, {laser: null, distance: Infinity}).laser;

    if (closestLaser) {
      const evadeAngle = Math.atan2(shipY - closestLaser.y, shipX - closestLaser.x);
      return {
        dx: Math.cos(evadeAngle) * BASE_SPEED * speedMultiplier,
        dy: Math.sin(evadeAngle) * BASE_SPEED * speedMultiplier,
        angle: evadeAngle
      };
    }
  }

  // Normal movement
  if (Math.random() < 0.02) {
    const targetAngle = Math.atan2(enemyY - shipY, enemyX - shipX);
    const randomOffset = (Math.random() - 0.5) * Math.PI / 2;
    const angle = targetAngle + randomOffset;
    return {
      dx: Math.cos(angle) * BASE_SPEED * speedMultiplier,
      dy: Math.sin(angle) * BASE_SPEED * speedMultiplier,
      angle: angle
    };
  }
  return { dx: shipDx, dy: shipDy, angle: Math.atan2(shipDy, shipDx) };
}

function keepShipInBounds(x, y, dx, dy) {
  let newX = x;
  let newY = y;
  let newDx = dx;
  let newDy = dy;

  if (x < SHIP_SIZE / 2) {
    newX = SHIP_SIZE / 2;
    newDx = Math.abs(dx); // Reverse direction if hitting left edge
  } else if (x > window.innerWidth - SHIP_SIZE / 2) {
    newX = window.innerWidth - SHIP_SIZE / 2;
    newDx = -Math.abs(dx); // Reverse direction if hitting right edge
  }

  if (y < SHIP_SIZE / 2) {
    newY = SHIP_SIZE / 2;
    newDy = Math.abs(dy); // Reverse direction if hitting top edge
  } else if (y > window.innerHeight - SHIP_SIZE / 2) {
    newY = window.innerHeight - SHIP_SIZE / 2;
    newDy = -Math.abs(dy); // Reverse direction if hitting bottom edge
  }

  return { x: newX, y: newY, dx: newDx, dy: newDy };
}

function updateSpeed(change) {
  speedMultiplier = Math.max(MIN_SPEED, Math.min(MAX_SPEED, speedMultiplier + change));
  speedDisplay.textContent = `Speed: ${speedMultiplier.toFixed(1)}x`;
}

speedUpBtn.addEventListener('click', () => updateSpeed(0.1));
speedDownBtn.addEventListener('click', () => updateSpeed(-0.1));

function gameLoop() {
  if (!isGameOver) {
    const ship1Update = updateShipDirection(ship1X, ship1Y, ship1Dx, ship1Dy, ship2X, ship2Y);
    const ship2Update = updateShipDirection(ship2X, ship2Y, ship2Dx, ship2Dy, ship1X, ship1Y);

    ship1Dx = ship1Update.dx;
    ship1Dy = ship1Update.dy;
    ship2Dx = ship2Update.dx;
    ship2Dy = ship2Update.dy;

    ship1X += ship1Dx;
    ship1Y += ship1Dy;
    ship2X += ship2Dx;
    ship2Y += ship2Dy;

    const ship1Pos = keepShipInBounds(ship1X, ship1Y, ship1Dx, ship1Dy);
    const ship2Pos = keepShipInBounds(ship2X, ship2Y, ship2Dx, ship2Dy);

    ship1X = ship1Pos.x;
    ship1Y = ship1Pos.y;
    ship1Dx = ship1Pos.dx;
    ship1Dy = ship1Pos.dy;

    ship2X = ship2Pos.x;
    ship2Y = ship2Pos.y;
    ship2Dx = ship2Pos.dx;
    ship2Dy = ship2Pos.dy;

    moveShip(ship1, ship1X, ship1Y, ship1Update.angle);
    moveShip(ship2, ship2X, ship2Y, ship2Update.angle);

    if (Math.random() < 0.02 * speedMultiplier) {
      const dx = ship2X - ship1X;
      const dy = ship2Y - ship1Y;
      const mag = Math.sqrt(dx * dx + dy * dy);
      createLaser(ship1X, ship1Y, dx / mag, dy / mag, 1);
    }

    if (Math.random() < 0.02 * speedMultiplier) {
      const dx = ship1X - ship2X;
      const dy = ship1Y - ship2Y;
      const mag = Math.sqrt(dx * dx + dy * dy);
      createLaser(ship2X, ship2Y, dx / mag, dy / mag, 2);
    }

    moveLasers();
  }

  addStars();

  requestAnimationFrame(gameLoop);
}

// Initialize stars
for (let i = 0; i < 50; i++) {
  createStar();
}

gameLoop();
</script>
</body></html>